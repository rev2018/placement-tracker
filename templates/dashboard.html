{% extends "base.html" %}
{% block content %}
<div class="top-row">
  <div>
    <h1>Dashboard</h1>
    <p class="muted">Track your applications, deadlines and chaos.</p>
  </div>
  <div>
    <a class="btn" href="{{ url_for('new_application') }}">+ Add Application</a>
  </div>
</div>

<div class="stats">
  <div class="stat">
    <div class="stat-title">Total Applied</div>
    <div class="stat-value">{{ total }}</div>
  </div>
  <div class="stat">
    <div class="stat-title">Selected</div>
    <div class="stat-value">{{ selected }}</div>
  </div>
  {% for s in statuses %}
  <div class="stat">
    <div class="stat-title">{{ s }}</div>
    <div class="stat-value">{{ counts[s] }}</div>
  </div>
  {% endfor %}
</div>

<div class="card">
  <form class="filters" method="GET" action="{{ url_for('dashboard') }}">
    <input type="text" name="search" placeholder="Search by company or role..." value="{{ search }}">
    <select name="status">
      <option value="">All Status</option>
      {% for s in statuses %}
        <option value="{{ s }}" {% if status_filter==s %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>
    <button class="btn small" type="submit">Filter</button>
    <a class="btn small ghost" href="{{ url_for('dashboard') }}">Reset</a>
  </form>
</div>

<div class="card">
  <h2>Your Applications</h2>

  {% if applications|length == 0 %}
    <p class="muted">No applications yet. Click “Add Application” to start.</p>
  {% else %}
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Company</th>
            <th>Role</th>
            <th>Status</th>
            <th>Applied</th>
            <th>Next Round</th>
            <th>Resume</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for a in applications %}
          <tr>
            <td>{{ a["company_name"] }}</td>
            <td>{{ a["role"] }}</td>
            <td><span class="pill {{ a['status']|lower }}">{{ a["status"] }}</span></td>
            <td>{{ a["applied_date"] }}</td>
            <td>{{ a["next_round_date"] if a["next_round_date"] else "-" }}</td>
            <td>
              {% if a["resume_link"] %}
                <a href="{{ a['resume_link'] }}" target="_blank">Link</a>
              {% else %}
                -
              {% endif %}
            </td>
            <td class="actions">
              <a class="btn small ghost" href="{{ url_for('edit_application', app_id=a['id']) }}">Edit</a>
              <form method="POST" action="{{ url_for('delete_application', app_id=a['id']) }}" onsubmit="return confirm('Delete this application?');">
                <button class="btn small danger" type="submit">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
</div>
{% endblock %}
